/*
 * Copyright (c) 2022 Huawei Device Co., Ltd.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { describe, beforeAll,it, expect } from "@ohos/hypium"
import ohosWindow from '@ohos.window';
import screen from '@ohos.screen';
import display from '@ohos.display';
import screenshot from '@ohos.screenshot';
import { UiDriver, BY, ON, PointerMatrix, UiComponent } from '@ohos.UiTest'
import Ability from '@ohos.app.ability.Ability';
import { BusinessError, Callback } from '@ohos.base';
import { UIContext } from '@ohos.arkui.UIContext';

function unexpectedError(error: BusinessError, caseName: string, apiName: string, TRUE_FLAG: boolean, done: Function) {
  let msgStr: string = 'jsUnittest ' + caseName + ' ' + apiName + ' failed, err: ';
  console.log(msgStr + JSON.stringify(error));
  expect(TRUE_FLAG).assertFail();
  done();
}

async function sleep(time: number) {
  let timeoutId: number = null;
  let promise = new Promise<string>(resolve => {
    timeoutId = setTimeout(() => {
      resolve('sleep finished');
    }, time);
  })
  await promise;
  clearTimeout(timeoutId)
}


function buttonClick(buttonText: string, msgStr: string) {
  console.info(msgStr + `case come in buttonClick fun`)
  return new Promise<string>(async (resolve, reject) => {
    let driver = await UiDriver.create()
    console.info(msgStr + `case come in buttonClick fun 222`)
    console.info(msgStr + `driver is ${JSON.stringify(driver)}`)
    await sleep(1000)
    console.info(msgStr + `UiDriver start`)
    let button: UiComponent = null
    button = await driver.findComponent(BY.text(buttonText))
    console.info(msgStr + `button is ${JSON.stringify(button)}`)
    await sleep(1000)
    if (button) {
      console.info(msgStr + `button click begin`)
      await button.click()
      console.info(msgStr + `button click end`)
      resolve(msgStr + 'get button successed')
    } else {
      console.info(msgStr + `inter else: button is null`)
      reject(msgStr + 'get button failed')
    }
  })
}

function inputClick(buttonText: string, msgStr: string) {
  console.info(msgStr + `case come in inputClick fun`)
  return new Promise<string>(async (resolve, reject) => {
    let driver = await UiDriver.create()
    console.info(msgStr + `case come in inputClick fun 222`)
    console.info(msgStr + `driver is ${JSON.stringify(driver)}`)
    await sleep(1000)
    console.info(msgStr + `UiDriver start`)
    let input: UiComponent = null
    input = await driver.findComponent(BY.key(buttonText))
    console.info(msgStr + `input is ${JSON.stringify(input)}`)
    await sleep(1000)
    if (input) {
      console.info(msgStr + `input click begin`)
      await input.click()
      console.info(msgStr + `input click end`)
      resolve(msgStr + 'get input successed')
    } else {
      console.info(msgStr + `inter else: input is null`)
      reject(msgStr + 'get input failed')
    }
  })
}

export default function windowPromiseTest(context: Context, windowStage: ohosWindow.WindowStage, abilityStorage: LocalStorage) {
  console.log('windowTest context: ' + JSON.stringify(context))
  console.log('windowTest abilityStorage: ' + JSON.stringify(abilityStorage))
  describe('windowInterface_optionalParameter_test', () => {
    console.log('describe window_api_test start!!!')
    const TRUE_FLAG: boolean = true;

    beforeAll(async () => {
      // 点击掉USB用于的弹窗
      let msgStr: string = 'USB用于的弹窗';
      await buttonClick('取消', msgStr).catch(async (err: BusinessError) => {
        console.info(msgStr + err);
      })
    })
    /**
     * @tc.number    : SUB_BASIC_WMS_SPCIAL_XTS_STAGE_JS_API_2360
     * @tc.name      : testTouchOutsideBaseTest
     * @tc.desc      : Enable listening for click events outside the area of this window
     * @tc.size      : MediumTest
     * @tc.type      : Function
     * @tc.level     : Level4
     */
    it('testTouchOutsideBaseTest', 0, async (done: Function) => {
      let caseName: string = 'testTouchOutsideBaseTest';
      let msgStr: string = 'jsUnittest ' + caseName + ' ';
      let mainWin: ohosWindow.Window | void = null;
      mainWin = await windowStage.getMainWindow().catch((err: BusinessError) => {
        expect().assertFail();
        done();
      });
      console.log(msgStr + 'getMainWindow success');
      let callback = () => {
        console.log('windowTest on/off touchOutside callback success');
      }
      try {
        // @ts-ignore
        (mainWin as ohosWindow.Window).on('touchOutside', callback);
      } catch (err) {
        console.log(msgStr + 'window on touchOutside failed');
        expect().assertFail();
        done();
      }
      await sleep(1000);
      try {
        // @ts-ignore
        (mainWin as ohosWindow.Window).off('touchOutside', callback);
        done();
      } catch (err) {
        console.log(msgStr + 'window off touchOutside failed');
        expect().assertFail();
        done();
      }
    });

    /**
     * @tc.number    : SUB_BASIC_WMS_SPCIAL_XTS_STAGE_JS_API_2370
     * @tc.name      : testWindowOffTouchOutsideCancelAll
     * @tc.desc      : Turns off listening for click events outside this window area.
     * @tc.size      : MediumTest
     * @tc.type      : Function
     * @tc.level     : Level4
     */
    it('testWindowOffTouchOutsideCancelAll', 0, async (done: Function) => {
      let caseName: string = 'testWindowOffTouchOutsideCancelAll';
      let msgStr: string = 'jsUnittest ' + caseName + ' ';
      console.log(msgStr + 'begin');
      let windowId: string = 'touchOutside01';
      let windowId_two: string = 'touchOutside001';
      let num: number = 0
      let firstListenFlag: boolean = false
      let secondListenFlag: boolean = false
      let windowConfig: ohosWindow.Configuration = {
        name: windowId, windowType: ohosWindow.WindowType.TYPE_FLOAT, ctx: context
      };
      let windowConfig_two: ohosWindow.Configuration = {
        name: windowId_two, windowType: ohosWindow.WindowType.TYPE_FLOAT, ctx: context
      };
      let tempWnd: ohosWindow.Window | void = null;
      let tempWnd_two: ohosWindow.Window | void = null;
      tempWnd = await ohosWindow.createWindow(windowConfig).catch((err: BusinessError) => {
        console.log(msgStr + 'createWindow tempWnd failed');
        expect().assertFail();
        done();
      });
      expect(!!tempWnd).assertTrue();
      await (tempWnd as ohosWindow.Window).loadContent('MainAbility/pages/second/second')
        .catch((err: BusinessError) => {
          console.log(msgStr + 'tempWnd.loadContent failed');
          expect().assertFail();
          done();
        });
      await (tempWnd as ohosWindow.Window).resize(400, 400).catch((err: BusinessError) => {
        console.log(msgStr + 'tempWnd.resize failed');
        expect().assertFail();
        done();
      });
      await (tempWnd as ohosWindow.Window).moveWindowTo(0, 0).catch((err: BusinessError) => {
        console.log(msgStr + 'tempWnd.moveWindowTo failed');
        expect().assertFail();
        done();
      });
      await (tempWnd as ohosWindow.Window).showWindow().catch((err: BusinessError) => {
        console.log(msgStr + 'tempWnd.showWindow failed');
        expect().assertFail();
        done();
      });
      tempWnd_two = await ohosWindow.createWindow(windowConfig_two).catch((err: BusinessError) => {
        console.log(msgStr + 'createWindow tempWnd_two failed');
        expect().assertFail();
        done();
      });
      expect(!!tempWnd_two).assertTrue();
      await (tempWnd_two as ohosWindow.Window).loadContent('MainAbility/pages/second/pageOne')
        .catch((err: BusinessError) => {
          console.log(msgStr + 'tempWnd_two.loadContent failed');
          expect().assertFail();
          done();
        });
      await (tempWnd_two as ohosWindow.Window).resize(500, 500).catch((err: BusinessError) => {
        console.log(msgStr + 'tempWnd_two.resize failed');
        expect().assertFail();
        done();
      });
      await (tempWnd_two as ohosWindow.Window).moveWindowTo(0, 500).catch((err: BusinessError) => {
        console.log(msgStr + 'tempWnd_two.moveWindowTo failed');
        expect().assertFail();
        done();
      });
      await (tempWnd_two as ohosWindow.Window).showWindow().catch((err: BusinessError) => {
        console.log(msgStr + 'tempWnd_two.showWindow failed');
        expect().assertFail();
        done();
      });
      // @ts-ignore
      (tempWnd as ohosWindow.Window).on('touchOutside', (data: ohosWindow.WindowEventType) => {
        console.info(msgStr + "first listener trigger");
        num++
        firstListenFlag = true
      });
      // @ts-ignore
      (tempWnd as ohosWindow.Window).on('touchOutside', (data: ohosWindow.WindowEventType) => {
        console.info(msgStr + "second listener trigger");
        num++
        secondListenFlag = true
      });
      await sleep(3000);
      await buttonClick("点击pageOne", msgStr).catch(async (err: BusinessError) => {
        console.info(msgStr + err);
        await (tempWnd as ohosWindow.Window).destroyWindow();
        await (tempWnd_two as ohosWindow.Window).destroyWindow();
        expect().assertFail();
        done();
      });
      // @ts-ignore
      (tempWnd as ohosWindow.Window).off('touchOutside');
      firstListenFlag = false
      secondListenFlag = false
      await buttonClick('点击pageOne', msgStr).catch(async (err: BusinessError) => {
        console.info(msgStr + err);
        await (tempWnd as ohosWindow.Window).destroyWindow();
        await (tempWnd_two as ohosWindow.Window).destroyWindow();
        expect().assertFail();
        done();
      })
      if (num >= 2 && firstListenFlag === false && secondListenFlag === false) {
        await (tempWnd as ohosWindow.Window).destroyWindow();
        await (tempWnd_two as ohosWindow.Window).destroyWindow();
        done();
      } else {
        expect().assertFail();
        done();
      }
    })
    /**
     * @tc.number    : SUB_BASIC_WMS_SPCIAL_XTS_STAGE_JS_API_2380
     * @tc.name      : Test testWindowOffTouchOutsideCancelSingle
     * @tc.desc      : Turns off listening for click events outside this window area.
     * @tc.size      : MediumTest
     * @tc.type      : Function
     * @tc.level     : Level4
     */
    it('testWindowOffTouchOutsideCancelSingle', 0, async (done: Function) => {
      let caseName: string = 'testWindowOffTouchOutsideCancelSingle';
      let msgStr: string = 'jsUnittest ' + caseName + ' ';
      console.log(msgStr + 'begin');
      let firstListenFlag: boolean = false
      let secondListenFlag: boolean = false

      let firstCall: Callback<ohosWindow.WindowEventType> = () => {
        console.log(msgStr + "first listener trigger")
        firstListenFlag = true
        return firstListenFlag
      }

      let secondCall: Callback<ohosWindow.WindowEventType> = () => {
        console.log(msgStr + "second listener trigger")
        secondListenFlag = true
        return secondListenFlag
      }

      let windowId: string = 'touchOutside02';
      let windowId_two: string = 'touchOutside002';
      let windowConfig: ohosWindow.Configuration = {
        name: windowId, windowType: ohosWindow.WindowType.TYPE_FLOAT, ctx: context
      };
      let windowConfig_two: ohosWindow.Configuration = {
        name: windowId_two, windowType: ohosWindow.WindowType.TYPE_FLOAT, ctx: context
      };
      let tempWnd: ohosWindow.Window | void = null;
      let tempWnd_two: ohosWindow.Window | void = null;
      tempWnd = await ohosWindow.createWindow(windowConfig).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'ohosWindow.createWindow', TRUE_FLAG, done);
      });
      expect(!!tempWnd).assertTrue();
      await (tempWnd as ohosWindow.Window).loadContent('MainAbility/pages/second/second')
        .catch((err: BusinessError) => {
          unexpectedError(err, caseName, 'tempWnd.resetSize', TRUE_FLAG, done);
        });
      await (tempWnd as ohosWindow.Window).resize(400, 400).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.resetSize', TRUE_FLAG, done);
      });
      await (tempWnd as ohosWindow.Window).moveWindowTo(0, 0).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.moveWindowTo ', TRUE_FLAG, done);
      });
      await (tempWnd as ohosWindow.Window).show().catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.show', TRUE_FLAG, done);
      });
      tempWnd_two = await ohosWindow.createWindow(windowConfig_two).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'ohosWindow.createWindow', TRUE_FLAG, done);
      });
      expect(!!tempWnd_two).assertTrue();
      await (tempWnd_two as ohosWindow.Window).loadContent('MainAbility/pages/second/pageOne')
        .catch((err: BusinessError) => {
          unexpectedError(err, caseName, 'tempWnd.resetSize', TRUE_FLAG, done);
        });
      await (tempWnd_two as ohosWindow.Window).resize(500, 500).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.resetSize', TRUE_FLAG, done);
      });
      await (tempWnd_two as ohosWindow.Window).moveWindowTo(0, 500).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.moveWindowTo ', TRUE_FLAG, done);
      });
      await (tempWnd_two as ohosWindow.Window).show().catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.show', TRUE_FLAG, done);
      });
      // @ts-ignore
      (tempWnd as ohosWindow.Window).on('touchOutside', firstCall);
      // @ts-ignore
      (tempWnd as ohosWindow.Window).on('touchOutside', secondCall);
      await sleep(1000);
      await buttonClick('点击pageOne', msgStr).catch(async (err: BusinessError) => {
        console.info(msgStr + err);
        await (tempWnd as ohosWindow.Window).destroyWindow();
        await (tempWnd_two as ohosWindow.Window).destroyWindow();
        expect(TRUE_FLAG).assertFail();
        done();
      });
      // @ts-ignore
      (tempWnd as ohosWindow.Window).off('touchOutside', firstCall);
      firstListenFlag = false
      secondListenFlag = false
      await buttonClick('点击pageOne', msgStr).catch(async (err: BusinessError) => {
        console.info(msgStr + err);
        await (tempWnd as ohosWindow.Window).destroyWindow();
        await (tempWnd_two as ohosWindow.Window).destroyWindow();
        expect(TRUE_FLAG).assertFail();
        done();
      })
      await sleep(1000)
      await (tempWnd as ohosWindow.Window).destroyWindow();
      await (tempWnd_two as ohosWindow.Window).destroyWindow();
      if (!firstListenFlag && secondListenFlag) {
        done();
      } else {
        expect(TRUE_FLAG).assertFail();
        done();
      }
    })

    /**
     * @tc.number    : SUB_BASIC_WMS_SPCIAL_XTS_STAGE_JS_API_2170
     * @tc.name      : testWindowStage_loadContent_Test_001
     * @tc.desc      : Verify The optional parameter is undefined
     * @tc.size      : MediumTest
     * @tc.type      : Function
     * @tc.level     : Level4
     */
    it('testWindowStage_loadContent_Test_001', 0, async (done: Function) => {
      let caseName: string = 'windowStage_loadContent_Test_001';
      let msgStr: string = 'jsUnittest ' + caseName + ' ';
      console.log(msgStr + 'begin');
      let load: void = await windowStage.loadContent('MainAbility/pages/second/second', undefined)
        .catch((err: BusinessError) => {
          console.log(msgStr + 'windowStage loadContent MainAbility/pages/second/second' + JSON.stringify(err));
          expect().assertFail();
          done();
        });
      expect(!Boolean(load)).assertTrue();
      done();
    })
    /**
     * @tc.number    : SUB_BASIC_WMS_SPCIAL_XTS_STAGE_JS_API_2280
     * @tc.name      : testWindow_off_WindowSizeChange_No_Callback
     * @tc.desc      : Turn off listening for window size changes.
     * @tc.size      : MediumTest
     * @tc.type      : Function
     * @tc.level     : Level4
     */
    it('testWindow_off_WindowSizeChange_No_Callback', 0, async (done: Function) => {
      let caseName: string = 'testWindow_off_WindowSizeChange_No_Callback';
      let msgStr: string = 'jsUnittest ' + caseName + ' ';
      console.log(msgStr + 'begin');
      let num: number = 0
      let firstListenFlag: boolean = false
      let secondListenFlag: boolean = false
      let baseWndType: number = ohosWindow.WindowType.TYPE_FLOAT;
      let windowId: string = 'window_off_windowSizeChange_Test_001';
      console.log(msgStr + 'begin');
      let windowConfig: ohosWindow.Configuration = {
        name: windowId, windowType: baseWndType, ctx: context
      };
      let tempWnd: ohosWindow.Window | void = null;
      tempWnd = await ohosWindow.createWindow(windowConfig).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'ohosWindow.createWindow', TRUE_FLAG, done);
      });
      expect(!!tempWnd).assertTrue();
      (tempWnd as ohosWindow.Window).on('windowSizeChange', () => {
        console.info(msgStr + "first listener trigger");
        num++
        firstListenFlag = true
      });
      (tempWnd as ohosWindow.Window).on('windowSizeChange', (data) => {
        console.info(msgStr + "second listener trigger");
        num++
        secondListenFlag = true
      });
      await (tempWnd as ohosWindow.Window).show().catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.show', TRUE_FLAG, done);
      });
      console.log(msgStr + 'tempWnd.show success');
      await (tempWnd as ohosWindow.Window).setWindowMode(102).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.setWindowMode 102', TRUE_FLAG, done);
      });
      await (tempWnd as ohosWindow.Window).resize(200, 600).catch(async (err: BusinessError) => {
        console.error(msgStr + 'Failed to change the window size. Cause: ' + JSON.stringify(err));
        expect().assertFail();
        await (tempWnd as ohosWindow.Window).destroyWindow();
        done();
      })
      await sleep(1000);
      (tempWnd as ohosWindow.Window).off('windowSizeChange');
      firstListenFlag = false
      secondListenFlag = false
      await (tempWnd as ohosWindow.Window).resize(500, 500).catch(async (err: BusinessError) => {
        console.error(msgStr + 'Failed to change the window size. Cause: ' + JSON.stringify(err));
        expect().assertFail();
        await (tempWnd as ohosWindow.Window).destroyWindow();
        done();
      })
      console.error(msgStr + 'num : ' + num);
      await sleep(500);
      if (num >= 2 && firstListenFlag === false && secondListenFlag === false) {
        await (tempWnd as ohosWindow.Window).destroyWindow();
        done();
      }
    })
    /**
     * @tc.number    : SUB_BASIC_WMS_SPCIAL_XTS_STAGE_JS_API_2290
     * @tc.name      : testWindow_off_WindowSizeChange_SecondCall_Callback
     * @tc.desc      : Turn off listening for window size changes.
     * @tc.size      : MediumTest
     * @tc.type      : Function
     * @tc.level     : Level4
     */
    it('testWindow_off_WindowSizeChange_SecondCall_Callback', 0, async (done: Function) => {
      let caseName: string = 'testWindow_off_WindowSizeChange_SecondCall_Callback';
      let msgStr: string = 'jsUnittest ' + caseName + ' ';
      console.log(msgStr + 'begin');
      let firstListenFlag: boolean = false
      let secondListenFlag: boolean = false
      let baseWndType = ohosWindow.WindowType.TYPE_FLOAT;
      let windowId: string = 'window_off_windowSizeChange_Test_002';
      let windowConfig: ohosWindow.Configuration = {
        name: windowId, windowType: baseWndType, ctx: context
      };
      let tempWnd: ohosWindow.Window | void = null;
      tempWnd = await ohosWindow.createWindow(windowConfig).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'ohosWindow.createWindow', TRUE_FLAG, done);
      });
      expect(!!tempWnd).assertTrue();

      let firstCall: Callback<ohosWindow.WindowEventType> = () => {
        console.log(msgStr + "first listener trigger")
        firstListenFlag = true
      }

      let secondCall = () => {
        console.log(msgStr + "second listener trigger")
        secondListenFlag = true
      }

      (tempWnd as ohosWindow.Window).on('windowEvent', firstCall);
      (tempWnd as ohosWindow.Window).on('windowSizeChange', secondCall);
      await (tempWnd as ohosWindow.Window).show().catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.show', TRUE_FLAG, done);
      });
      console.log(msgStr + 'tempWnd.show success');
      await (tempWnd as ohosWindow.Window).setWindowMode(102).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.setWindowMode 102', TRUE_FLAG, done);
      });
      await (tempWnd as ohosWindow.Window).resize(200, 600).catch(async (err: BusinessError) => {
        console.error(msgStr + 'Failed to change the window size. Cause: ' + JSON.stringify(err));
        expect().assertFail();
        await (tempWnd as ohosWindow.Window).destroyWindow();
        done();
      })
      await sleep(1000);
      // @ts-ignore
      (tempWnd as ohosWindow.Window).off('windowSizeChange', firstCall);
      firstListenFlag = false
      secondListenFlag = false
      await (tempWnd as ohosWindow.Window).resize(500, 500).catch(async (err: BusinessError) => {
        console.error(msgStr + 'Failed to change the window size. Cause: ' + JSON.stringify(err));
        expect().assertFail();
        await (tempWnd as ohosWindow.Window).destroyWindow();
        done();
      })
      await sleep(500);
      if (!firstListenFlag && secondListenFlag) {
        (tempWnd as ohosWindow.Window).off('windowSizeChange');
        await (tempWnd as ohosWindow.Window).destroyWindow();
        done();
      } else {
        (tempWnd as ohosWindow.Window).off('windowSizeChange');
        await (tempWnd as ohosWindow.Window).destroyWindow();
        expect(TRUE_FLAG).assertFail();
        done();
      }
    })
    /**
     * @tc.number    : SUB_BASIC_WMS_SPCIAL_XTS_STAGE_JS_API_2200
     * @tc.name      : testWindow_off_AvoidAreaChange_AllListening_LogOut
     * @tc.desc      : Disable listening for system avoidance zone changes.
     * @tc.size      : MediumTest
     * @tc.type      : Function
     * @tc.level     : Level4
     */
    it('testWindow_off_AvoidAreaChange_AllListening_LogOut', 0, async (done: Function) => {
      let caseName: string = 'testWindow_off_AvoidAreaChange_AllListening_LogOut';
      let msgStr: string = 'jsUnittest ' + caseName + ' ';
      console.log(msgStr + 'begin');
      let num: number = 0
      let firstListenFlag: boolean = false
      let secondListenFlag: boolean = false
      let tempWnd: ohosWindow.Window | void = null
      tempWnd = await windowStage.getMainWindow().catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'windowStage.getMainWindow', TRUE_FLAG, done);
      });
      expect(!!tempWnd).assertTrue();
      await (tempWnd as ohosWindow.Window).show().catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.show', TRUE_FLAG, done);
      });
      (tempWnd as ohosWindow.Window).on('avoidAreaChange', () => {
        console.info(msgStr + "first listener trigger");
        num++
        firstListenFlag = true
      });
      (tempWnd as ohosWindow.Window).on('avoidAreaChange', (data) => {
        console.info(msgStr + 'second listener trigger');
        num++
        secondListenFlag = true
      });
      await (tempWnd as ohosWindow.Window).setFullScreen(true).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.setFullScreen(true)', TRUE_FLAG, done);
      });
      await (tempWnd as ohosWindow.Window).setSystemBarEnable(['status']).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.setSystemBarEnable([status])', TRUE_FLAG, done);
      });
      await sleep(1000);
      (tempWnd as ohosWindow.Window).off('avoidAreaChange');
      firstListenFlag = false
      secondListenFlag = false
      await (tempWnd as ohosWindow.Window).setSystemBarEnable([]).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.setSystemBarEnable([navigation])', TRUE_FLAG, done);
      });
      await sleep(500);
      await (tempWnd as ohosWindow.Window).setSystemBarEnable(['status', 'navigation']).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.setSystemBarEnable([status])', TRUE_FLAG, done);
      });
      if (num >= 2 && firstListenFlag === false && secondListenFlag === false) {
        done();
      }
    })
    /**
     * @tc.number    : SUB_BASIC_WMS_SPCIAL_XTS_STAGE_JS_API_2210
     * @tc.name      : testWindow_off_AvoidAreaChange_FirstCall_LogOut
     * @tc.desc      : Disable listening for system avoidance zone changes.
     * @tc.size      : MediumTest
     * @tc.type      : Function
     * @tc.level     : Level4
     */
    it('testWindow_off_AvoidAreaChange_FirstCall_LogOut', 0, async (done: Function) => {
      let caseName: string = 'testWindow_off_AvoidAreaChange_FirstCall_LogOut';
      let msgStr: string = 'jsUnittest ' + caseName + ' ';
      console.log(msgStr + 'begin');
      let firstListenFlag: boolean = false
      let secondListenFlag: boolean = false

      let firstCall = () => {
        console.log(msgStr + "first listener trigger")
        firstListenFlag = true
      }

      let secondCall = () => {
        console.log(msgStr + "second listener trigger")
        secondListenFlag = true
      }

      let tempWnd = await windowStage.getMainWindow().catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'windowStage.getMainWindow', TRUE_FLAG, done);
      });
      expect(!!tempWnd).assertTrue();
      await (tempWnd as ohosWindow.Window).show().catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.show', TRUE_FLAG, done);
      });
      console.log(msgStr + 'tempWnd.show success');
      (tempWnd as ohosWindow.Window).on('avoidAreaChange', firstCall);
      (tempWnd as ohosWindow.Window).on('avoidAreaChange', secondCall);
      await (tempWnd as ohosWindow.Window).setFullScreen(true).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.setFullScreen(true)', TRUE_FLAG, done);
      });
      await sleep(1000);
      (tempWnd as ohosWindow.Window).off('avoidAreaChange', firstCall);
      firstListenFlag = false
      secondListenFlag = false
      await (tempWnd as ohosWindow.Window).setSystemBarEnable([]).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.setSystemBarEnable([navigation])', TRUE_FLAG, done);
      });
      await (tempWnd as ohosWindow.Window).setSystemBarEnable(['status', 'navigation']).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.setSystemBarEnable([status])', TRUE_FLAG, done);
      });
      await sleep(1000);
      if (!firstListenFlag && secondListenFlag) {
        (tempWnd as ohosWindow.Window).off('avoidAreaChange');
        done();
      } else {
        (tempWnd as ohosWindow.Window).off('avoidAreaChange');
        expect(TRUE_FLAG).assertFail();
        done();
      }
    })

    /**
     * @tc.number    : SUB_BASIC_WMS_SPCIAL_XTS_STAGE_JS_API_2260
     * @tc.name      : testWindow_off_screenshot_AllListening_LogOut
     * @tc.desc      : Disable the monitoring of screenshots.
     * @tc.size      : MediumTest
     * @tc.type      : Function
     * @tc.level     : Level4
     */
    it('testWindow_off_screenshot_AllListening_LogOut', 0, async (done: Function) => {
      let caseName: string = 'testWindow_off_screenshot_AllListening_LogOut';
      let msgStr: string = 'jsUnittest ' + caseName + ' ';
      console.log(msgStr + 'begin');
      let num: number = 0
      let firstListenFlag: boolean = false
      let secondListenFlag: boolean = false
      let windowId: string = 'window_off_screenshot_Test_001';
      let windowConfig: ohosWindow.Configuration = {
        name: windowId, windowType: ohosWindow.WindowType.TYPE_FLOAT, ctx: context
      };
      let tempWnd: ohosWindow.Window | void = null;
      tempWnd = await ohosWindow.createWindow(windowConfig).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'ohosWindow.createWindow', TRUE_FLAG, done);
      });
      expect(!!tempWnd).assertTrue();
      await (tempWnd as ohosWindow.Window).loadContent('MainAbility/pages/second/pageOne')
        .catch((err: BusinessError) => {
          unexpectedError(err, caseName, 'tempWnd.resetSize', TRUE_FLAG, done);
        });
      await (tempWnd as ohosWindow.Window).resize(500, 500).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.resetSize', TRUE_FLAG, done);
      });
      await (tempWnd as ohosWindow.Window).show().catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.show', TRUE_FLAG, done);
      });
      (tempWnd as ohosWindow.Window).on('screenshot', (data) => {
        console.info(msgStr + "first listener trigger");
        num++
        firstListenFlag = true
      });
      (tempWnd as ohosWindow.Window).on('screenshot', (data) => {
        console.info(msgStr + "second listener trigger");
        num++
        secondListenFlag = true
      });
      // 截屏代码
      await screenshot.save().then((pixelMap: PixelMap) => {
        console.log('Succeeded in saving sreenshot. Pixel bytes number: ' + pixelMap.getPixelBytesNumber());
        pixelMap.release(); // PixelMap使用完后及时释放内存
      }).catch((err: BusinessError) => {
        console.log('Failed to save screenshot. Code: ' + JSON.stringify(err));
        expect().assertFail();
        done();
      });
      await sleep(1000);
      (tempWnd as ohosWindow.Window).off('screenshot');
      firstListenFlag = false
      secondListenFlag = false
      // 截屏代码
      await screenshot.save().then((pixelMap: PixelMap) => {
        console.log('Succeeded in saving sreenShot. Pixel bytes number: ' + pixelMap.getPixelBytesNumber());
        pixelMap.release(); // PixelMap使用完后及时释放内存
      }).catch((err: BusinessError) => {
        console.log('Failed to save screenshot. Code: ' + JSON.stringify(err));
        expect().assertFail();
        done();
      });
      await sleep(1000);
      if (num >= 2 && firstListenFlag === false && secondListenFlag === false) {
        await (tempWnd as ohosWindow.Window).destroyWindow();
        done();
      } else {
        await (tempWnd as ohosWindow.Window).destroyWindow();
        expect(TRUE_FLAG).assertFail();
        done();
      }
    })
    /**
     * @tc.number    : SUB_BASIC_WMS_SPCIAL_XTS_STAGE_JS_API_2270
     * @tc.name      : testWindow_off_screenshot_FirstCall_LogOut
     * @tc.desc      : Disable the monitoring of screenshots.
     * @tc.size      : MediumTest
     * @tc.type      : Function
     * @tc.level     : Level4
     */
    it('testWindow_off_screenshot_FirstCall_LogOut', 0, async (done: Function) => {
      let caseName: string = 'testWindow_off_screenshot_FirstCall_LogOut';
      let msgStr: string = 'jsUnittest ' + caseName + ' ';
      console.log(msgStr + 'begin');
      let firstListenFlag: boolean = false
      let secondListenFlag: boolean = false

      let firstCall: Callback<void> = () => {
        console.log(msgStr + "first listener trigger")
        firstListenFlag = true
      }

      let secondCall: Callback<void> = () => {
        console.log(msgStr + "second listener trigger")
        secondListenFlag = true
      }

      let windowId: string = 'window_off_screenshot_Test_002';
      let windowConfig: ohosWindow.Configuration = {
        name: windowId, windowType: ohosWindow.WindowType.TYPE_FLOAT, ctx: context
      };
      let tempWnd: ohosWindow.Window | void = null;
      tempWnd = await ohosWindow.createWindow(windowConfig).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'ohosWindow.createWindow', TRUE_FLAG, done);
      });
      expect(!!tempWnd).assertTrue();
      await (tempWnd as ohosWindow.Window).loadContent('MainAbility/pages/second/pageOne')
        .catch((err: BusinessError) => {
          unexpectedError(err, caseName, 'tempWnd.resetSize', TRUE_FLAG, done);
        });
      await (tempWnd as ohosWindow.Window).resize(500, 500).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.resetSize', TRUE_FLAG, done);
      });
      await (tempWnd as ohosWindow.Window).show().catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.show', TRUE_FLAG, done);
      });
      (tempWnd as ohosWindow.Window).on('screenshot', firstCall);
      (tempWnd as ohosWindow.Window).on('screenshot', secondCall);

      // 截屏代码
      await screenshot.save().then((pixelMap: PixelMap) => {
        console.log('Succeeded in saving sreenShot. Pixel bytes number: ' + pixelMap.getPixelBytesNumber());
        pixelMap.release(); // PixelMap使用完后及时释放内存
      }).catch((err: BusinessError) => {
        console.log('Failed to save screenshot. Code: ' + JSON.stringify(err));
        expect().assertFail();
        done();
      });
      await sleep(1000);
      (tempWnd as ohosWindow.Window).off('screenshot', firstCall);
      firstListenFlag = false
      secondListenFlag = false
      // 截屏代码
      await screenshot.save().then((pixelMap: PixelMap) => {
        console.log('Succeeded in saving sreenshot. Pixel bytes number: ' + pixelMap.getPixelBytesNumber());
        pixelMap.release(); // PixelMap使用完后及时释放内存
      }).catch((err: BusinessError) => {
        console.log('Failed to save screenshot. Code: ' + JSON.stringify(err));
        expect().assertFail();
        done();
      });
      await sleep(1000);
      (tempWnd as ohosWindow.Window).off('screenshot');
      await (tempWnd as ohosWindow.Window).destroyWindow();
      if (!firstListenFlag && secondListenFlag) {
        done();
      } else {
        expect(TRUE_FLAG).assertFail();
        done();
      }
    })
    /**
     * @tc.number    : SUB_BASIC_WMS_SPCIAL_XTS_STAGE_JS_API_2220
     * @tc.name      : testWindow_off_dialogTargetTouch_AllListening_LogOut
     * @tc.desc      : Turns on modal window listener for click events on target Windows.
     * @tc.size      : MediumTest
     * @tc.type      : Function
     * @tc.level     : Level4
     */
    it('testWindow_off_dialogTargetTouch_AllListening_LogOut', 0, async (done: Function) => {
      let caseName: string = 'testWindow_off_dialogTargetTouch_AllListening_LogOut';
      let msgStr: string = 'jsUnittest ' + caseName + ' ';
      console.log(msgStr + 'begin');
      let num: number = 0
      let firstListenFlag: boolean = false
      let secondListenFlag: boolean = false
      let windowId: string = 'window_off_dialogTargetTouch_Test_001';
      let windowConfig: ohosWindow.Configuration = {
        name: windowId, windowType: ohosWindow.WindowType.TYPE_DIALOG, ctx: context
      };
      let tempWnd: ohosWindow.Window | void = null;
      tempWnd = await ohosWindow.createWindow(windowConfig).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'ohosWindow.createWindow', TRUE_FLAG, done);
      });
      expect(!!tempWnd).assertTrue();
      await (tempWnd as ohosWindow.Window).loadContent('MainAbility/pages/second/pageOne')
        .catch((err: BusinessError) => {
          unexpectedError(err, caseName, 'tempWnd.resetSize', TRUE_FLAG, done);
        });
      await (tempWnd as ohosWindow.Window).resize(500, 500).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.resetSize', TRUE_FLAG, done);
      });
      await (tempWnd as ohosWindow.Window).show().catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.show', TRUE_FLAG, done);
      });
      (tempWnd as ohosWindow.Window).on('dialogTargetTouch', (data) => {
        console.info(msgStr + "first listener trigger");
        num++
        firstListenFlag = true
      });
      (tempWnd as ohosWindow.Window).on('dialogTargetTouch', (data) => {
        console.info(msgStr + "second listener trigger");
        num++
        secondListenFlag = true
      });
      // 点击模态窗口
      await buttonClick('secondPage_BackToIndex', msgStr).catch(async (err: BusinessError) => {
        console.info(msgStr + err);
        await (tempWnd as ohosWindow.Window).destroyWindow();
        expect(TRUE_FLAG).assertFail();
        done();
      })
      await sleep(1000);
      (tempWnd as ohosWindow.Window).off('dialogTargetTouch');
      firstListenFlag = false
      secondListenFlag = false
      await buttonClick('secondPage_BackToIndex', msgStr).catch(async (err: BusinessError) => {
        console.info(msgStr + err);
        await (tempWnd as ohosWindow.Window).destroyWindow();
        expect(TRUE_FLAG).assertFail();
        done();
      })
      await sleep(1000);
      if (num >= 2 && firstListenFlag === false && secondListenFlag === false) {
        await (tempWnd as ohosWindow.Window).destroyWindow();
        done();
      }
    })
    /**
     * @tc.number    : SUB_BASIC_WMS_SPCIAL_XTS_STAGE_JS_API_2230
     * @tc.name      : testWindow_off_dialogTargetTouch_FirstCall_LogOut
     * @tc.desc      : Turns on modal window listener for click events on target Windows.
     * @tc.size      : MediumTest
     * @tc.type      : Function
     * @tc.level     : Level4
     */
    it('testWindow_off_dialogTargetTouch_FirstCall_LogOut', 0, async (done: Function) => {
      let caseName: string = 'testWindow_off_dialogTargetTouch_FirstCall_LogOut';
      let msgStr: string = 'jsUnittest ' + caseName + ' ';
      console.log(msgStr + 'begin');
      let firstListenFlag: boolean = false
      let secondListenFlag: boolean = false

      let firstCall: Callback<void> = () => {
        console.log(msgStr + "first listener trigger")
        firstListenFlag = true
      }

      let secondCall: Callback<void> = () => {
        console.log(msgStr + "second listener trigger")
        secondListenFlag = true
      }

      let windowId: string = 'window_off_dialogTargetTouch_Test_002';
      let windowConfig: ohosWindow.Configuration = {
        name: windowId, windowType: ohosWindow.WindowType.TYPE_DIALOG, ctx: context
      };
      let tempWnd: ohosWindow.Window | void = null;
      tempWnd = await ohosWindow.createWindow(windowConfig).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'ohosWindow.createWindow', TRUE_FLAG, done);
      });
      expect(!!tempWnd).assertTrue();
      await (tempWnd as ohosWindow.Window).loadContent('MainAbility/pages/second/pageOne')
        .catch((err: BusinessError) => {
          unexpectedError(err, caseName, 'tempWnd.resetSize', TRUE_FLAG, done);
        });
      await (tempWnd as ohosWindow.Window).resize(500, 500).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.resetSize', TRUE_FLAG, done);
      });
      await (tempWnd as ohosWindow.Window).show().catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.show', TRUE_FLAG, done);
      });
      (tempWnd as ohosWindow.Window).on('dialogTargetTouch', firstCall);
      (tempWnd as ohosWindow.Window).on('dialogTargetTouch', secondCall);
      await buttonClick('secondPage_BackToIndex', msgStr).catch(async (err: BusinessError) => {
        console.info(msgStr + err);
        await (tempWnd as ohosWindow.Window).destroyWindow();
        expect(TRUE_FLAG).assertFail();
        done();
      })
      await sleep(1000);
      (tempWnd as ohosWindow.Window).off('dialogTargetTouch', firstCall);
      firstListenFlag = false
      secondListenFlag = false
      await buttonClick('secondPage_BackToIndex', msgStr).catch(async (err: BusinessError) => {
        console.info(msgStr + err);
        await (tempWnd as ohosWindow.Window).destroyWindow();
        expect(TRUE_FLAG).assertFail();
        done();
      })
      await sleep(1000);
      (tempWnd as ohosWindow.Window).off('dialogTargetTouch');
      await (tempWnd as ohosWindow.Window).destroyWindow();
      if (!firstListenFlag && secondListenFlag) {
        done();
      } else {
        expect(TRUE_FLAG).assertFail();
        done();
      }
    })
    /**
     * @tc.number    : SUB_BASIC_WMS_SPCIAL_XTS_STAGE_JS_API_2240
     * @tc.name      : testWindow_off_keyboardHeightChange_AllListening_LogOut
     * @tc.desc      : Turn off listening for keyboard height changes
     * @tc.size      : MediumTest
     * @tc.type      : Function
     * @tc.level     : Level4
     */
    it('testWindow_off_keyboardHeightChange_AllListening_LogOut', 0, async (done: Function) => {
      let caseName: string = 'testWindow_off_keyboardHeightChange_AllListening_LogOut';
      let msgStr: string = 'jsUnittest ' + caseName + ' ';
      console.log(msgStr + 'begin');
      let num: number = 0
      let firstListenFlag: boolean = false
      let secondListenFlag: boolean = false
      let windowId: string = 'window_off_keyboardHeightChange_Test_001';
      let windowConfig: ohosWindow.Configuration = {
        name: windowId, windowType: ohosWindow.WindowType.TYPE_DIALOG, ctx: context
      };
      let tempWnd: ohosWindow.Window | void = null;
      tempWnd = await ohosWindow.createWindow(windowConfig).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'ohosWindow.createWindow', TRUE_FLAG, done);
      });
      expect(!!tempWnd).assertTrue();
      await (tempWnd as ohosWindow.Window).loadContent('MainAbility/pages/second/pageTwo')
        .catch((err: BusinessError) => {
          unexpectedError(err, caseName, 'tempWnd.loadContent', TRUE_FLAG, done);
        });
      let current_display_Class = display.getDefaultDisplaySync();
      await (tempWnd as ohosWindow.Window).resize(800, current_display_Class.height).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.resetSize', TRUE_FLAG, done);
      });
      await (tempWnd as ohosWindow.Window).moveWindowTo(0, 0).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.moveWindowTo ', TRUE_FLAG, done);
      });
      await (tempWnd as ohosWindow.Window).showWindow().catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.showWindow', TRUE_FLAG, done);
      });
      (tempWnd as ohosWindow.Window).on('keyboardHeightChange', (data) => {
        console.info(msgStr + "first listener trigger");
        num++
        firstListenFlag = true
      });
      (tempWnd as ohosWindow.Window).on('keyboardHeightChange', (data) => {
        console.info(msgStr + "second listener trigger");
        num++
        secondListenFlag = true
      });
      await inputClick('pageTwoinput', msgStr).catch(async (err: BusinessError) => {
        console.info(msgStr + err);
        await (tempWnd as ohosWindow.Window).destroyWindow();
        expect(TRUE_FLAG).assertFail();
        done();
      })
      await sleep(1000);
      (tempWnd as ohosWindow.Window).off('keyboardHeightChange');
      firstListenFlag = false
      secondListenFlag = false
      await sleep(1000);
      await buttonClick('点击按钮获取焦点', msgStr).catch(async (err: BusinessError) => {
        console.info(msgStr + err);
        await (tempWnd as ohosWindow.Window).destroyWindow();
        expect().assertFail();
        done();
      })
      await sleep(1000);
      await inputClick('pageTwoinputSecond', msgStr).catch(async (err: BusinessError) => {
        console.info(msgStr + err);
        await (tempWnd as ohosWindow.Window).destroyWindow();
        expect(TRUE_FLAG).assertFail();
        done();
      })
      await sleep(2000);
      if (num >= 2 && firstListenFlag === false && secondListenFlag === false) {
        await (tempWnd as ohosWindow.Window).destroyWindow();
        done();
      }
    })
    /**
     * @tc.number    : SUB_BASIC_WMS_SPCIAL_XTS_STAGE_JS_API_2250
     * @tc.name      : testWindow_off_keyboardHeightChange_FirstCall_LogOut
     * @tc.desc      : Turn off listening for keyboard height changes
     * @tc.size      : MediumTest
     * @tc.type      : Function
     * @tc.level     : Level4
     */
    it('testWindow_off_keyboardHeightChange_FirstCall_LogOut', 0, async (done: Function) => {
      let caseName: string = 'testWindow_off_keyboardHeightChange_FirstCall_LogOut';
      let msgStr: string = 'jsUnittest ' + caseName + ' ';
      console.log(msgStr + 'begin');
      let firstListenFlag: boolean = false
      let secondListenFlag: boolean = false

      let firstCall: Callback<number> = () => {
        console.log(msgStr + "first listener trigger")
        firstListenFlag = true
      }

      let secondCall: Callback<number> = () => {
        console.log(msgStr + "second listener trigger")
        secondListenFlag = true
      }

      let windowId: string = 'window_off_keyboardHeightChange_Test_002';
      let windowConfig: ohosWindow.Configuration = {
        name: windowId, windowType: ohosWindow.WindowType.TYPE_DIALOG, ctx: context
      };
      let tempWnd: ohosWindow.Window | void = null;
      tempWnd = await ohosWindow.createWindow(windowConfig).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'ohosWindow.createWindow', TRUE_FLAG, done);
      });
      expect(!!tempWnd).assertTrue();
      await (tempWnd as ohosWindow.Window).loadContent('MainAbility/pages/second/pageTwo')
        .catch((err: BusinessError) => {
          unexpectedError(err, caseName, 'tempWnd.loadContent', TRUE_FLAG, done);
        });
      let current_display_Class = display.getDefaultDisplaySync();
      await (tempWnd as ohosWindow.Window).resize(800, current_display_Class.height).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.resetSize', TRUE_FLAG, done);
      });
      await (tempWnd as ohosWindow.Window).moveWindowTo(0, 0).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.moveWindowTo ', TRUE_FLAG, done);
      });
      await (tempWnd as ohosWindow.Window).showWindow().catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.showWindow', TRUE_FLAG, done);
      });
      (tempWnd as ohosWindow.Window).on('keyboardHeightChange', firstCall);
      (tempWnd as ohosWindow.Window).on('keyboardHeightChange', secondCall);
      await inputClick('pageTwoInput', msgStr).catch(async (err: BusinessError) => {
        console.info(msgStr + err);
        await (tempWnd as ohosWindow.Window).destroyWindow();
        expect(TRUE_FLAG).assertFail();
        done();
      })
      await sleep(1000);
      (tempWnd as ohosWindow.Window).off('keyboardHeightChange', firstCall);
      firstListenFlag = false
      secondListenFlag = false
      await sleep(1000);
      await buttonClick('点击按钮获取焦点', msgStr).catch(async (err: BusinessError) => {
        console.info(msgStr + err);
        await (tempWnd as ohosWindow.Window).destroyWindow();
        expect().assertFail();
        done();
      })
      await sleep(1000);
      await inputClick('pageTwoInputSecond', msgStr).catch(async (err: BusinessError) => {
        console.info(msgStr + err);
        await (tempWnd as ohosWindow.Window).destroyWindow();
        expect(TRUE_FLAG).assertFail();
        done();
      })
      await sleep(2000);
      if (!firstListenFlag && secondListenFlag) {
        (tempWnd as ohosWindow.Window).off('keyboardHeightChange');
        await (tempWnd as ohosWindow.Window).destroyWindow();
        done();
      } else {
        (tempWnd as ohosWindow.Window).off('keyboardHeightChange');
        await (tempWnd as ohosWindow.Window).destroyWindow();
        expect(TRUE_FLAG).assertFail();
        done();
      }
    })

    /**
     * @tc.number    : SUB_BASIC_WMS_SPCIAL_XTS_STAGE_JS_API_2180
     * @tc.name      : testWindowStage_off_windowStageEvent_AllListening_LogOut
     * @tc.desc      : Turn off listening for Windows Stage life cycle changes.
     * @tc.size      : MediumTest
     * @tc.type      : Function
     * @tc.level     : Level4
     */
    it('testWindowStage_off_windowStageEvent_AllListening_LogOut', 0, async (done: Function) => {
      let caseName: string = 'testWindowStage_off_windowStageEvent_AllListening_LogOut';
      let msgStr: string = 'jsUnittest ' + caseName + ' ';
      console.log(msgStr + 'begin');
      let num: number = 0
      let firstListenFlag: boolean = false
      let secondListenFlag: boolean = false

      let firstCall: Callback<ohosWindow.WindowStageEventType> = () => {
        console.log(msgStr + "first listener trigger")
        num++
        firstListenFlag = true
      }

      let secondCall: Callback<ohosWindow.WindowStageEventType> = () => {
        console.log(msgStr + "second listener trigger")
        num++
        secondListenFlag = true
      }

      let tempWnd: ohosWindow.Window | void = null;
      tempWnd = windowStage.getMainWindowSync();
      expect(!!tempWnd).assertTrue();
      windowStage.on("windowStageEvent", firstCall);
      windowStage.on("windowStageEvent", secondCall);
      await (tempWnd as ohosWindow.Window).hide().catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.hide', TRUE_FLAG, done);
      });
      await sleep(1000);
      windowStage.off("windowStageEvent");
      firstListenFlag = false
      secondListenFlag = false
      await (tempWnd as ohosWindow.Window).show().catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.show', TRUE_FLAG, done);
      });
      await sleep(1000);
      if (num >= 2 && firstListenFlag === false && secondListenFlag === false) {
        done();
      }
    })
    /**
     * @tc.number    : SUB_BASIC_WMS_SPCIAL_XTS_STAGE_JS_API_2190
     * @tc.name      : testWindowStage_off_windowStageEvent_FirstCall_LogOut
     * @tc.desc      : Turn off listening for Windows Stage life cycle changes.
     * @tc.size      : MediumTest
     * @tc.type      : Function
     * @tc.level     : Level4
     */
    it('testWindowStage_off_windowStageEvent_FirstCall_LogOut', 0, async (done: Function) => {
      let caseName: string = 'testWindowStage_off_windowStageEvent_FirstCall_LogOut';
      let msgStr: string = 'jsUnittest ' + caseName + ' ';
      console.log(msgStr + 'begin');
      let firstListenFlag: boolean = false
      let secondListenFlag: boolean = false

      let firstCall: Callback<ohosWindow.WindowStageEventType> = () => {
        console.log(msgStr + "first listener trigger")
        firstListenFlag = true
      }

      let secondCall: Callback<ohosWindow.WindowStageEventType> = () => {
        console.log(msgStr + "second listener trigger")
        secondListenFlag = true
      }

      let tempWnd: ohosWindow.Window | void = null;
      tempWnd = windowStage.getMainWindowSync();
      expect(!!tempWnd).assertTrue();
      windowStage.on("windowStageEvent", firstCall);
      windowStage.on("windowStageEvent", secondCall);
      await (tempWnd as ohosWindow.Window).hide().catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.hide', TRUE_FLAG, done);
      });
      await sleep(1000);
      windowStage.off("windowStageEvent", firstCall);
      firstListenFlag = false
      secondListenFlag = false
      await (tempWnd as ohosWindow.Window).show().catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'tempWnd.show', TRUE_FLAG, done);
      });
      await sleep(1000);
      windowStage.off("windowStageEvent");
      if (!firstListenFlag && secondListenFlag) {
        done();
      } else {
        expect(TRUE_FLAG).assertFail();
        done();
      }
    })

    /**
     * @tc.number    : SUB_BASIC_WMS_SPCIAL_XTS_STAGE_JS_API_0340
     * @tc.name      : testDisplay_off_add_Deregister_All_Listeners
     * @tc.desc      : Enable the monitor that shows device changes.
     * @tc.size      : MediumTest
     * @tc.type      : Function
     * @tc.level     : Level4
     */
    it('testDisplay_off_add_Deregister_All_Listeners', 0, async (done: Function) => {
      let caseName: string = 'testDisplay_off_add_Deregister_All_Listeners';
      let msgStr: string = 'jsUnittest ' + caseName + ' ';
      console.log(msgStr + 'begin');
      let num: number = 0
      let firstListenFlag: boolean = false
      let secondListenFlag: boolean = false
      let screenClass: screen.createVirtualScreen = null;
      let screenClass_two: screen.createVirtualScreen = null;

      let firstCall = () => {
        console.log(msgStr + "first listener trigger")
        num++
        firstListenFlag = true
      }

      let secondCall = () => {
        console.log(msgStr + "second listener trigger")
        num++
        secondListenFlag = true
      }

      display.on("add", firstCall);
      display.on("add", secondCall);
      screenClass = await screen.createVirtualScreen({
        name: 'add01',
        width: 1080,
        height: 2340,
        density: 2,
        surfaceId: ''
      }).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'screen.createVirtualScreen', TRUE_FLAG, done);
      });
      expect(!!screenClass).assertTrue();
      await screen.makeExpand([{
        screenId: 0, startX: 0, startY: 0
      }, {
        screenId: screenClass.id, startX: 1080, startY: 0
      }]).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'screen.makeExpand', TRUE_FLAG, done);
      });
      await sleep(1000);
      display.off('add')
      firstListenFlag = false
      secondListenFlag = false
      await screen.destroyVirtualScreen(screenClass.id)
      screenClass_two = await screen.createVirtualScreen({
        name: 'add001',
        width: 900,
        height: 2000,
        density: 3,
        surfaceId: ''
      }).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'screen.createVirtualScreen', TRUE_FLAG, done);
      });
      expect(!!screenClass_two).assertTrue();
      await screen.makeExpand([{
        screenId: 0, startX: 0, startY: 0
      }, {
        screenId: screenClass_two.id, startX: 1080, startY: 0
      }]).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'screen.makeExpand', TRUE_FLAG, done);
      });
      await sleep(1000);
      if (num >= 2 && firstListenFlag === false && secondListenFlag === false) {
        await screen.destroyVirtualScreen(screenClass_two.id)
        done();
      }
    })
    /**
     * @tc.number    : SUB_BASIC_WMS_SPCIAL_XTS_STAGE_JS_API_0350
     * @tc.name      : testDisplay_off_add_Deregister_FirstCall_Listeners
     * @tc.desc      : Enable the monitor that shows device changes.
     * @tc.size      : MediumTest
     * @tc.type      : Function
     * @tc.level     : Level4
     */
    it('testDisplay_off_add_Deregister_FirstCall_Listeners', 0, async (done: Function) => {
      let caseName: string = 'testDisplay_off_add_Deregister_FirstCall_Listeners';
      let msgStr: string = 'jsUnittest ' + caseName + ' ';
      console.log(msgStr + 'begin');
      let firstListenFlag: boolean = false
      let secondListenFlag: boolean = false
      let screenClass: screen.createVirtualScreen = null;
      let screenClass_two: screen.createVirtualScreen = null;

      let firstCall: Callback<number> = () => {
        console.log(msgStr + "first listener trigger")
        firstListenFlag = true
      }

      let secondCall: Callback<number> = () => {
        console.log(msgStr + "second listener trigger")
        secondListenFlag = true
      }

      display.on("add", firstCall);
      display.on("add", secondCall);
      screenClass = await screen.createVirtualScreen({
        name: 'add02',
        width: 1080,
        height: 2340,
        density: 2,
        surfaceId: ''
      }).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'screen.createVirtualScreen', TRUE_FLAG, done);
      });
      expect(!!screenClass).assertTrue();
      await screen.makeExpand([{
        screenId: 0, startX: 0, startY: 0
      }, {
        screenId: screenClass.id, startX: 1080, startY: 0
      }]).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'screen.makeExpand', TRUE_FLAG, done);
      });
      await sleep(1000);
      display.off("add", firstCall)
      firstListenFlag = false
      secondListenFlag = false
      await screen.destroyVirtualScreen(screenClass.id)
      screenClass_two = await screen.createVirtualScreen({
        name: 'add002',
        width: 900,
        height: 2000,
        density: 3,
        surfaceId: ''
      }).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'screen.createVirtualScreen', TRUE_FLAG, done);
      });
      expect(!!screenClass_two).assertTrue();
      await screen.makeExpand([{
        screenId: 0, startX: 0, startY: 0
      }, {
        screenId: screenClass_two.id, startX: 1080, startY: 0
      }]).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'screen.makeExpand', TRUE_FLAG, done);
      });
      await sleep(1000);
      await screen.destroyVirtualScreen(screenClass_two.id)
      display.off("add")
      if (!firstListenFlag && secondListenFlag) {
        done();
      } else {
        expect(TRUE_FLAG).assertFail();
        done();
      }
    })
    /**
     * @tc.number    : SUB_BASIC_WMS_SPCIAL_XTS_STAGE_JS_API_0380
     * @tc.name      : testDisplay_off_remove_Deregister_All_Listeners
     * @tc.desc      : Enable the monitor that shows device changes.
     * @tc.size      : MediumTest
     * @tc.type      : Function
     * @tc.level     : Level4
     */
    it('testDisplay_off_remove_Deregister_All_Listeners', 0, async (done: Function) => {
      let caseName: string = 'testDisplay_off_remove_Deregister_All_Listeners';
      let msgStr: string = 'jsUnittest ' + caseName + ' ';
      console.log(msgStr + 'begin');
      let num: number = 0
      let firstListenFlag: boolean = false
      let secondListenFlag: boolean = false
      let screenClass: screen.createVirtualScreen = null;
      let screenClass_two: screen.createVirtualScreen = null;

      let firstCall: Callback<number> = () => {
        console.log(msgStr + "first listener trigger")
        num++
        firstListenFlag = true
      }

      let secondCall: Callback<number> = () => {
        console.log(msgStr + "second listener trigger")
        num++
        secondListenFlag = true
      }

      display.on('remove', firstCall);
      display.on('remove', secondCall);
      screenClass = await screen.createVirtualScreen({
        name: 'remove01',
        width: 1080,
        height: 2340,
        density: 2,
        surfaceId: ''
      }).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'screen.createVirtualScreen', TRUE_FLAG, done);
      });
      expect(!!screenClass).assertTrue();
      await screen.makeExpand([{
        screenId: 0, startX: 0, startY: 0
      }, {
        screenId: screenClass.id, startX: 1080, startY: 0
      }]).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'screen.makeExpand', TRUE_FLAG, done);
      });
      await screen.destroyVirtualScreen(screenClass.id)
      await sleep(1000);
      display.off('remove')
      firstListenFlag = false
      secondListenFlag = false
      screenClass_two = await screen.createVirtualScreen({
        name: 'remove001',
        width: 900,
        height: 2000,
        density: 3,
        surfaceId: ''
      }).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'screen.createVirtualScreen', TRUE_FLAG, done);
      });
      expect(!!screenClass_two).assertTrue();
      await screen.makeExpand([{
        screenId: 0, startX: 0, startY: 0
      }, {
        screenId: screenClass_two.id, startX: 1080, startY: 0
      }]).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'screen.makeExpand', TRUE_FLAG, done);
      });
      await screen.destroyVirtualScreen(screenClass_two.id)
      await sleep(1000);
      if (num >= 2 && firstListenFlag === false && secondListenFlag === false) {
        done();
      }
    })
    /**
     * @tc.number    : SUB_BASIC_WMS_SPCIAL_XTS_STAGE_JS_API_0390
     * @tc.name      : testDisplay_off_remove_Deregister_FirstCall_Listeners
     * @tc.desc      : Enable the monitor that shows device changes.
     * @tc.size      : MediumTest
     * @tc.type      : Function
     * @tc.level     : Level4
     */
    it('testDisplay_off_remove_Deregister_FirstCall_Listeners', 0, async (done: Function) => {
      let caseName: string = 'testDisplay_off_remove_Deregister_FirstCall_Listeners';
      let msgStr: string = 'jsUnittest ' + caseName + ' ';
      console.log(msgStr + 'begin');
      let firstListenFlag: boolean = false
      let secondListenFlag: boolean = false
      let screenClass: screen.createVirtualScreen = null;
      let screenClass_two: screen.createVirtualScreen = null;

      let firstCall: Callback<number> = () => {
        console.log(msgStr + "first listener trigger")
        firstListenFlag = true
      }

      let secondCall: Callback<number> = () => {
        console.log(msgStr + "second listener trigger")
        secondListenFlag = true
      }

      display.on('remove', firstCall);
      display.on('remove', secondCall);
      screenClass = await screen.createVirtualScreen({
        name: 'remove02',
        width: 1080,
        height: 2340,
        density: 2,
        surfaceId: ''
      }).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'screen.createVirtualScreen', TRUE_FLAG, done);
      });
      expect(!!screenClass).assertTrue();
      await screen.makeExpand([{
        screenId: 0, startX: 0, startY: 0
      }, {
        screenId: screenClass.id, startX: 1080, startY: 0
      }]).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'screen.makeExpand', TRUE_FLAG, done);
      });
      await screen.destroyVirtualScreen(screenClass.id)
      await sleep(1000);
      display.off('remove', firstCall)
      firstListenFlag = false
      secondListenFlag = false
      screenClass_two = await screen.createVirtualScreen({
        name: 'remove002',
        width: 900,
        height: 2000,
        density: 3,
        surfaceId: ''
      }).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'screen.createVirtualScreen', TRUE_FLAG, done);
      });
      expect(!!screenClass_two).assertTrue();
      await screen.makeExpand([{
        screenId: 0, startX: 0, startY: 0
      }, {
        screenId: screenClass_two.id, startX: 1080, startY: 0
      }]).catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'screen.makeExpand', TRUE_FLAG, done);
      });
      await screen.destroyVirtualScreen(screenClass_two.id)
      await sleep(1000);
      display.off('remove')
      if (!firstListenFlag && secondListenFlag) {
        done();
      } else {
        expect(TRUE_FLAG).assertFail();
        done();
      }
    })
    /**
     * @tc.number    : SUB_BASIC_WMS_SPCIAL_XTS_STAGE_JS_API_0360
     * @tc.name      : testDisplay_off_change_Deregister_All_Listeners
     * @tc.desc      : Enable monitoring of screen status changes.
     * @tc.size      : MediumTest
     * @tc.type      : Function
     * @tc.level     : Level4
     */
    it('testDisplay_off_change_Deregister_All_Listeners', 0, async (done: Function) => {
      let caseName: string = 'testDisplay_off_change_Deregister_All_Listeners';
      let msgStr: string = 'jsUnittest ' + caseName + ' ';
      console.log(msgStr + 'begin');
      let num: number = 0
      let firstListenFlag: boolean = false
      let secondListenFlag: boolean = false

      let firstCall: Callback<number> = () => {
        console.log(msgStr + "first listener trigger")
        num++
        firstListenFlag = true
      }

      let secondCall: Callback<number> = () => {
        console.log(msgStr + "second listener trigger")
        num++
        secondListenFlag = true
      }

      display.on('change', firstCall);
      display.on('change', secondCall);
      let mainWindow: ohosWindow.Window | void = null
      mainWindow = await windowStage.getMainWindow().catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'windowStage.getMainWindow', TRUE_FLAG, done);
      });
      expect(!!mainWindow).assertTrue();
      await (mainWindow as ohosWindow.Window).setPreferredOrientation(ohosWindow.Orientation.PORTRAIT_INVERTED)
        .catch((err: BusinessError) => {
          console.error(msgStr + 'Failed to set the window orientation. Cause: ' + JSON.stringify(err));
          expect().assertFail();
          done();
        });
      await sleep(1000);
      display.off('change')
      firstListenFlag = false
      secondListenFlag = false
      await (mainWindow as ohosWindow.Window).setPreferredOrientation(ohosWindow.Orientation.UNSPECIFIED)
        .catch((err: BusinessError) => {
          console.error(msgStr + 'Failed to set the window orientation. Cause: ' + JSON.stringify(err));
          expect(TRUE_FLAG).assertFail();
          done();
        });
      await sleep(1000);
      if (num >= 2 && firstListenFlag === false && secondListenFlag === false) {
        done();
      } else {
        expect(TRUE_FLAG).assertFail();
        done();
      }
    })
    /**
     * @tc.number    : SUB_BASIC_WMS_SPCIAL_XTS_STAGE_JS_API_0370
     * @tc.name      : testDisplay_off_change_Deregister_FirstCall_Listeners
     * @tc.desc      : Enable monitoring of screen status changes.
     * @tc.size      : MediumTest
     * @tc.type      : Function
     * @tc.level     : Level4
     */
    it('testDisplay_off_change_Deregister_FirstCall_Listeners', 0, async (done: Function) => {
      let caseName: string = 'testDisplay_off_change_Deregister_FirstCall_Listeners';
      let msgStr: string = 'jsUnittest ' + caseName + ' ';
      console.log(msgStr + 'begin');
      let firstListenFlag: boolean = false
      let secondListenFlag: boolean = false

      let firstCall = () => {
        console.log(msgStr + "first listener trigger")
        firstListenFlag = true
      }

      let secondCall = () => {
        console.log(msgStr + "second listener trigger")
        secondListenFlag = true
      }

      display.on('change', firstCall);
      display.on('change', secondCall);
      let mainWindow: ohosWindow.Window | void = null
      mainWindow = await windowStage.getMainWindow().catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'windowStage.getMainWindow', TRUE_FLAG, done);
      });
      expect(!!mainWindow).assertTrue();
      await (mainWindow as ohosWindow.Window).setPreferredOrientation(ohosWindow.Orientation.PORTRAIT_INVERTED)
        .catch((err: BusinessError) => {
          console.error(msgStr + 'Failed to set the window orientation. Cause: ' + JSON.stringify(err));
          expect().assertFail();
          done();
        });
      await sleep(1000);
      display.off('change', firstCall)
      firstListenFlag = false
      secondListenFlag = false
      await (mainWindow as ohosWindow.Window).setPreferredOrientation(ohosWindow.Orientation.UNSPECIFIED)
        .catch((err: BusinessError) => {
          console.error(msgStr + 'Failed to set the window orientation. Cause: ' + JSON.stringify(err));
          expect().assertFail();
          done();
        });
      await sleep(1000);
      display.off('change')
      if (!firstListenFlag && secondListenFlag) {
        done();
      } else {
        expect(TRUE_FLAG).assertFail();
        done();
      }
    })
    /**
     * @tc.number    : SUB_BASIC_WMS_SPCIAL_XTS_STAGE_JS_API_0610
     * @tc.name      : testGetUIContext_Instances
     * @tc.desc      : Get the UIContext instance.
     * @tc.size      : MediumTest
     * @tc.type      : Function
     * @tc.level     : Level4
     */
    it('testGetUIContext_Instances', 0, async (done: Function) => {
      let caseName: string = 'testGetUIContext_Instances';
      let msgStr: string = 'jsUnittest ' + caseName + ' ';
      let uiContext: UIContext = null;
      console.log(msgStr + 'begin');
      let mainWindow: ohosWindow.Window | void = null
      mainWindow = await windowStage.getMainWindow().catch((err: BusinessError) => {
        unexpectedError(err, caseName, 'windowStage.getMainWindow', TRUE_FLAG, done);
      });
      expect(!!mainWindow).assertTrue();
      // 获取UIContext实例。
      uiContext = (mainWindow as ohosWindow.Window).getUIContext();
      expect(!!uiContext).assertTrue();
      console.log(msgStr + 'after uiContext: ' + JSON.stringify(uiContext));
      done();
    })

  })
}
